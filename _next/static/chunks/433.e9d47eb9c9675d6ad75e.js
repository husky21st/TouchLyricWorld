"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[433],{4433:function(e,t,i){i.r(t),i.d(t,{default:function(){return H}});var o=i(7294),n=i(5671),a=i(3144),r=i(4942),s=i(6841),u=i(6358),h=i(4607),c=i(1729),l=function(){function e(){(0,n.Z)(this,e)}return(0,a.Z)(e,null,[{key:"width",get:function(){return e._width}},{key:"height",get:function(){return e._height}},{key:"wr",get:function(){return e._width/100}},{key:"hr",get:function(){return e._height/100}},{key:"textScale",get:function(){return e._width/2e3}},{key:"initialize",value:function(t,i,o,n){console.log("Manager_init"),e._width=o,e._height=n,e.app=new s.Application({view:t,resolution:window.devicePixelRatio||1,backgroundColor:16317691,autoDensity:!1,antialias:!0,width:o,height:n}),u.p8.registerPlugin(h.w),h.w.registerPIXI(s),s.Loader.registerPlugin(c.r),s.TextMetrics.BASELINE_SYMBOL+="\u3042\u307d\uff5c",e.app.ticker.stop(),u.p8.ticker.fps(60),u.p8.ticker.add((function(){e.app.ticker.update()})),e.app.ticker.add(e.update),e._media=i,e.ManagerInitSetting()}},{key:"ManagerInitSetting",value:function(){var e=window.navigator.userAgent.toLowerCase();console.log(e),this.isSafari=!1,-1!=e.indexOf("edge")?console.log("use Edge"):-1!=e.indexOf("chrome")?console.log("use Google Chrome"):-1!=e.indexOf("safari")?(console.log("use Safari"),this.isSafari=!0):-1!=e.indexOf("firefox")?console.log("use FireFox"):-1!=e.indexOf("opera")?console.log("use Opera"):(console.log("undefined"),this.isSafari=!0),this.isSafari&&(s.settings.PREFER_ENV=s.ENV.WEBGL)}},{key:"_onResize",value:function(t,i){e._width=t,e._height=i,e.app.renderer.resize(e.width,e.height),e.currentScene&&e.currentScene.resize(),e.app.render(),setTimeout((function(){window.scrollTo(0,1)}),200)}},{key:"changeScene",value:function(t){e.currentScene&&(console.log("Manager_destroy"),e.app.stage.removeChild(e.currentScene),e.currentScene.destroy()),e.currentScene=t,e.currentScene.alpha=0,e.app.stage.addChild(e.currentScene),u.p8.to(e.currentScene,{pixi:{alpha:1},duration:.3})}},{key:"update",value:function(){e.currentScene&&e.currentScene.update()}}]),e}();(0,r.Z)(l,"app",void 0),(0,r.Z)(l,"currentScene",void 0),(0,r.Z)(l,"_width",void 0),(0,r.Z)(l,"_height",void 0),(0,r.Z)(l,"isSafari",void 0),(0,r.Z)(l,"_media",void 0),(0,r.Z)(l,"_song",void 0);var m=i(7326),d=i(9340),T=i(6215),v=i(1120),p=JSON.parse('{"C":["0123456789","abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ"],"f":["\u6a2a\u753b\u9762\u63a8\u5968\u3067\u3059","\u30d1\u30bd\u30b3\u30f3\u306e\u5834\u5408\u306f\u753b\u9762\u3092\u6a2a\u306b\u9577\u304f\u3057\u3066\u304b\u3089\u904a\u3093\u3067\u304f\u3060\u3055\u3044"]}'),x=[{name:"RocknRoll One",url:"https://fonts.googleapis.com/css2?family=RocknRoll+One&display=swap",metadata:{font:{testString:p.C.join("")+p.f.join("")}}},{name:"fontText",url:"Texts/FontPreloadingText.json"},{name:"leftMiku",url:"DancingMiku/left.png"},{name:"rightMiku",url:"DancingMiku/right.png"},{name:"centerMiku",url:"DancingMiku/center.png"},{name:"mainFlower",url:"Shapes/mainFlower.png"}],f=i(7172);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,o=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return(0,T.Z)(this,i)}}var k=function(e){(0,d.Z)(i,e);var t=y(i);function i(){var e;return(0,n.Z)(this,i),e=t.call(this),(0,r.Z)((0,m.Z)(e),"basedWidth",1920),(0,r.Z)((0,m.Z)(e),"basedHeight",1080),(0,r.Z)((0,m.Z)(e),"PI",Math.PI),e}return(0,a.Z)(i,[{key:"makeLine",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=this.basedWidth,n=(this.basedHeight,this.PI),a={width:5,color:1118481,alpha:1,join:s.LINE_JOIN.ROUND,cap:s.LINE_CAP.ROUND},r=new s.Graphics;if(0===e){var u=Math.min(t,5);if(u<=0)return void r.destroy();if(i){var h=154.8+25.2*u/5;r.lineStyle(a).arc(1.05*o,.04*o,o,154.8*n/180,n*h/180)}else{var c=180-25.2*u/5;r.lineStyle(a).arc(1.05*o,.04*o,o,180*n/180,n*c/180,!0)}}else if(1===e){var l=Math.min(t,5);if(l<=0)return void r.destroy();if(i){var m=11+26.2*(5-l)/5;r.lineStyle(a).arc(.65*-o,.14*-o,o,37.2*n/180,n*m/180,!0)}else{var d=11+26.2*l/5;r.lineStyle(a).arc(.65*-o,.14*-o,o,11*n/180,n*d/180)}}else if(2===e){var T=Math.min(t,5);if(T<=0)return void r.destroy();if(i){var v=142.8+26.2*T/5;r.lineStyle(a).arc(1.65*o,.14*-o,o,142.8*n/180,n*v/180)}else{var p=169-26.2*T/5;r.lineStyle(a).arc(1.65*o,.14*-o,o,169*n/180,n*p/180,!0)}}else if(3===e){var x=Math.min(t,5);if(x<=0)return void r.destroy();if(i){var f=25.2*(5-x)/5;r.lineStyle(a).arc(.05*-o,.04*o,o,25.2*n/180,n*f/180,!0)}else{var y=25.2*x/5;r.lineStyle(a).arc(.05*-o,.04*o,o,0,n*y/180)}}else if(4===e){var k=Math.min(t,7);if(k<=0)return void r.destroy();if(i){var g=118+39.1*k/7;r.lineStyle(a).arc(.9715*o,.3515*-o,o,118*n/180,n*g/180)}else{var L=157.1-39.1*k/7;r.lineStyle(a).arc(.9715*o,.3515*-o,o,157.1*n/180,n*L/180,!0)}}else if(5===e){var w=Math.min(t,7);if(w<=0)return void r.destroy();if(i){var S=62-39.1*w/7;r.lineStyle(a).arc(.0285*o,.3515*-o,o,62*n/180,n*S/180,!0)}else{var b=22.9+39.1*w/7;r.lineStyle(a).arc(.0285*o,.3515*-o,o,22.9*n/180,n*b/180)}}else if(6===e){var D=Math.min(t,4);if(D<=0)return void r.destroy();if(i){var Z=90+20.8*D/4;r.lineStyle(a).arc(.5*o,.469*-o,o,90*n/180,n*Z/180)}else{var _=110.8-20.8*D/4;r.lineStyle(a).arc(.5*o,.469*-o,o,110.8*n/180,n*_/180,!0)}}else if(7===e){var M=Math.min(t,4);if(M<=0)return void r.destroy();if(i){var B=90-20.8*M/4;r.lineStyle(a).arc(.5*o,.469*-o,o,90*n/180,n*B/180,!0)}else{var C=69.2+20.8*M/4;r.lineStyle(a).arc(.5*o,.469*-o,o,69.2*n/180,n*C/180)}}r.alpha=0,this.addChild(r)}}]),i}(s.Container);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,o=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return(0,T.Z)(this,i)}}var L=function(e){return Math.floor(Math.random()*e)},w=function(e){(0,d.Z)(i,e);var t=g(i);function i(e,o,a){var u;(0,n.Z)(this,i),(u=t.call(this))._ScoreText=o,u.allLyricText=a,(0,r.Z)((0,m.Z)(u),"charTextBoxs",void 0),(0,r.Z)((0,m.Z)(u),"phraseTexts",void 0),(0,r.Z)((0,m.Z)(u),"baseWR",6*l.wr);var h=l.wr,c=l.hr,d=l.textScale,T=performance.now();s.BitmapFont.from("BasicYuseiMagic",{fontFamily:"Yusei Magic",fill:"#00d2fc",fontSize:64},{resolution:2,chars:u.allLyricText}),s.BitmapFont.from("PhraseYuseiMagic",{fontFamily:"Yusei Magic",fill:"#ffffff",fontSize:64},{resolution:2,chars:u.allLyricText});var v=performance.now();return console.log("!!!1st",v-T),u.sortableChildren=!0,u.charTextBoxs=new Array,u.phraseTexts=new Array,u.createTexts(e,h,c,d),u}return(0,a.Z)(i,[{key:"createTexts",value:function(e,t,i,o){for(var n,a=this,r=performance.now(),u=[0,1,10,11,20,21,30,31,40,50,60,70,80,90],h=u.concat([2,3,12,13,22,23,32,33,41,42,51,52,61,71,81,91]),c=h.concat([4,14,24,34,43,53,62,63,64,72,73,74]),l=c.concat([65,75,82,83,84,92]),m=e.firstPhrase,d=new Array,T=0;null!==m;T++){var v=m.charCount,p=L((n=v<5?l:v<10?c:v<16?h:u).length),x=n[p];0!==T&&d[T-1]===x&&(x=n[p=L(n.length)]),d.push(x),m=m.next}m=e.firstPhrase;for(var f=0;null!==m;f++){for(var y=m.firstChar,k=function(e){var i=new s.Container;i.sortableChildren=!0;var n=new s.BitmapText(y.text,{fontName:"BasicYuseiMagic",tint:0,fontSize:64});n.anchor.set(.5,.55),n.scale.set(2.6*o),n.zIndex=100*(f+1)+e,i.addChild(n);var r=new s.BitmapText(y.text,{fontName:"BasicYuseiMagic",tint:16777215,fontSize:64});r.anchor.set(.5,.55),r.scale.set(2.7*o),r.zIndex=100*(f+1)+e-1e5,r.alpha=0,i.addChild(r);var u=new s.filters.BlurFilter;r.filters=[u];var h=(new s.Graphics).beginFill(255).drawCircle(0,0,5*t).endFill();h.alpha=0,i.addChild(h);var c=(new s.Graphics).beginFill(65280).drawCircle(0,0,4*t).endFill();c.alpha=0,i.addChild(c);var l=(new s.Graphics).beginFill(16711680).drawCircle(0,0,3*t).endFill();l.alpha=0,i.addChild(l);var m=(new s.Graphics).beginFill(16711680).drawCircle(0,0,2*t).endFill();m.alpha=0,i.addChild(m);var T=(new s.Graphics).beginFill(16711680).drawCircle(0,0,1*t).endFill();T.alpha=0,i.addChild(T),i.visible=!1,a.addChild(i);var v={TextBox:i,Duration:y.duration+50||50,Place:d[f],PhraseIndexOf:e,Reached:!1,Touched:!1};h.interactive=!0,h.buttonMode=!0,h.on("pointerout",(function(e){a.addScore(e,v)}),a),h.on("pointerover",(function(e){a.addScore(e,v)}),a),h.on("touchstart",(function(e){a.addScore(e,v)}),a),h.on("touchmove",(function(e){a.addScore(e,v)}),a),c.interactive=!0,c.buttonMode=!0,c.on("pointerout",(function(e){a.addScore(e,v)}),a),c.on("pointerover",(function(e){a.addScore(e,v)}),a),c.on("touchstart",(function(e){a.addScore(e,v)}),a),c.on("touchmove",(function(e){a.addScore(e,v)}),a),l.interactive=!0,l.buttonMode=!0,l.on("pointerout",(function(e){a.addScore(e,v)}),a),l.on("pointerover",(function(e){a.addScore(e,v)}),a),l.on("touchstart",(function(e){a.addScore(e,v)}),a),l.on("touchmove",(function(e){a.addScore(e,v)}),a),m.interactive=!0,m.buttonMode=!0,m.on("pointerout",(function(e){a.addScore(e,v)}),a),m.on("pointerover",(function(e){a.addScore(e,v)}),a),m.on("touchstart",(function(e){a.addScore(e,v)}),a),m.on("touchmove",(function(e){a.addScore(e,v)}),a),T.interactive=!0,T.buttonMode=!0,T.on("pointerout",(function(e){a.addScore(e,v)}),a),T.on("pointerover",(function(e){a.addScore(e,v)}),a),T.on("touchstart",(function(e){a.addScore(e,v)}),a),T.on("touchmove",(function(e){a.addScore(e,v)}),a),a.charTextBoxs.push(v),y=y.next},g=0;g<m.charCount;g++)k(g);var w=new s.BitmapText(m.text,{fontName:"PhraseYuseiMagic",tint:0,fontSize:64});w.anchor.set(.5),w.scale.set(o),w.zIndex=f,w.alpha=0,w.visible=!1,this.addChild(w),this.phraseTexts.push({TextBox:w,Duration:m.duration,NextDuration:m.next?m.next.duration:3e3,PhrasePlace:d[f],PhraseCharCount:m.charCount}),m=m.next}var S=performance.now();console.log("!2nd",S-r)}},{key:"addScore",value:function(e,t){if(t.Reached&&!t.Touched){var i,o,n=e.data.getLocalPosition(e.currentTarget);if(i=n.x,o=n.y,!(Math.sqrt(Math.pow(i,2)+Math.pow(o,2))>this.baseWR))t.Touched=!0,t.TextBox.children[0].alpha=1,this._ScoreText.changeScore()}}}]),i}(s.Container),S=function(){function e(t){(0,n.Z)(this,e),this._ScoreText=t,(0,r.Z)(this,"_MoveLyricText",void 0),this._MoveLyricText=new _(this._ScoreText)}return(0,a.Z)(e,[{key:"moveCharText",value:function(e){var t=e.Place,i=e.PhraseIndexOf;0===t?i<5?this.moveTextType0(e,i,e.Duration):i<9?this.moveTextType6(e,i-5,e.Duration):i<13?this.moveTextType7(e,i-9,e.Duration,!0):i<18?this.moveTextType3(e,i-13,e.Duration,!0):i<25?this.moveTextType5(e,i-18,e.Duration):i<32&&this.moveTextType4(e,i-25,e.Duration,!0):1===t?i<5?this.moveTextType0(e,i,e.Duration):i<9?this.moveTextType6(e,i-5,e.Duration):i<13?this.moveTextType7(e,i-9,e.Duration,!0):i<18?this.moveTextType3(e,i-13,e.Duration,!0):i<25?this.moveTextType5(e,i-18,e.Duration):i<29&&this.moveTextType6(e,i-25,e.Duration,!0):2===t?i<5?this.moveTextType0(e,i,e.Duration):i<9?this.moveTextType6(e,i-5,e.Duration):i<16&&this.moveTextType5(e,i-9,e.Duration,!0):3===t?i<5?this.moveTextType0(e,i,e.Duration):i<9?this.moveTextType6(e,i-5,e.Duration):i<16&&this.moveTextType4(e,i-9,e.Duration,!0):4===t?i<5?this.moveTextType0(e,i,e.Duration):i<10&&this.moveTextType1(e,i-5,e.Duration,!0):10===t?i<5?this.moveTextType3(e,i,e.Duration):i<9?this.moveTextType7(e,i-5,e.Duration):i<13?this.moveTextType6(e,i-9,e.Duration,!0):i<18?this.moveTextType0(e,i-13,e.Duration,!0):i<25?this.moveTextType4(e,i-18,e.Duration):i<32&&this.moveTextType5(e,i-25,e.Duration,!0):11===t?i<5?this.moveTextType3(e,i,e.Duration):i<9?this.moveTextType7(e,i-5,e.Duration):i<13?this.moveTextType6(e,i-9,e.Duration,!0):i<18?this.moveTextType0(e,i-13,e.Duration,!0):i<25?this.moveTextType4(e,i-18,e.Duration):i<29&&this.moveTextType7(e,i-25,e.Duration,!0):12===t?i<5?this.moveTextType3(e,i,e.Duration):i<9?this.moveTextType7(e,i-5,e.Duration):i<16&&this.moveTextType4(e,i-9,e.Duration,!0):13===t?i<5?this.moveTextType3(e,i,e.Duration):i<9?this.moveTextType7(e,i-5,e.Duration):i<16&&this.moveTextType5(e,i-9,e.Duration,!0):14===t?i<5?this.moveTextType3(e,i,e.Duration):i<10&&this.moveTextType2(e,i-5,e.Duration,!0):20===t?i<5?this.moveTextType1(e,i,e.Duration):i<9?this.moveTextType6(e,i-5,e.Duration):i<13?this.moveTextType7(e,i-9,e.Duration,!0):i<18?this.moveTextType3(e,i-13,e.Duration,!0):i<25?this.moveTextType5(e,i-18,e.Duration):i<32&&this.moveTextType4(e,i-25,e.Duration,!0):21===t?i<5?this.moveTextType1(e,i,e.Duration):i<9?this.moveTextType6(e,i-5,e.Duration):i<13?this.moveTextType7(e,i-9,e.Duration,!0):i<18?this.moveTextType3(e,i-13,e.Duration,!0):i<25?this.moveTextType5(e,i-18,e.Duration):i<29&&this.moveTextType6(e,i-25,e.Duration,!0):22===t?i<5?this.moveTextType1(e,i,e.Duration):i<9?this.moveTextType6(e,i-5,e.Duration):i<16&&this.moveTextType5(e,i-9,e.Duration,!0):23===t?i<5?this.moveTextType1(e,i,e.Duration):i<9?this.moveTextType6(e,i-5,e.Duration):i<16&&this.moveTextType4(e,i-9,e.Duration,!0):24===t?i<5?this.moveTextType1(e,i,e.Duration):i<10&&this.moveTextType0(e,i-5,e.Duration,!0):30===t?i<5?this.moveTextType2(e,i,e.Duration):i<9?this.moveTextType7(e,i-5,e.Duration):i<13?this.moveTextType6(e,i-9,e.Duration,!0):i<18?this.moveTextType0(e,i-13,e.Duration,!0):i<25?this.moveTextType4(e,i-18,e.Duration):i<32&&this.moveTextType5(e,i-25,e.Duration,!0):31===t?i<5?this.moveTextType2(e,i,e.Duration):i<9?this.moveTextType7(e,i-5,e.Duration):i<13?this.moveTextType6(e,i-9,e.Duration,!0):i<18?this.moveTextType0(e,i-13,e.Duration,!0):i<25?this.moveTextType4(e,i-18,e.Duration):i<29&&this.moveTextType7(e,i-25,e.Duration,!0):32===t?i<5?this.moveTextType2(e,i,e.Duration):i<9?this.moveTextType7(e,i-5,e.Duration):i<16&&this.moveTextType4(e,i-9,e.Duration,!0):33===t?i<5?this.moveTextType2(e,i,e.Duration):i<9?this.moveTextType7(e,i-5,e.Duration):i<16&&this.moveTextType5(e,i-9,e.Duration,!0):34===t?i<5?this.moveTextType2(e,i,e.Duration):i<10&&this.moveTextType3(e,i-5,e.Duration,!0):40===t?i<7?this.moveTextType4(e,i,e.Duration):i<11?this.moveTextType7(e,i-7,e.Duration,!0):i<16?this.moveTextType3(e,i-11,e.Duration,!0):i<23?this.moveTextType5(e,i-16,e.Duration):i<30&&this.moveTextType4(e,i-23,e.Duration,!0):41===t?i<7?this.moveTextType4(e,i,e.Duration):i<11?this.moveTextType7(e,i-7,e.Duration,!0):i<16?this.moveTextType3(e,i-11,e.Duration,!0):i<23?this.moveTextType5(e,i-16,e.Duration):i<27&&this.moveTextType6(e,i-23,e.Duration,!0):42===t?i<7?this.moveTextType4(e,i,e.Duration):i<11?this.moveTextType7(e,i-7,e.Duration,!0):i<16&&this.moveTextType2(e,i-11,e.Duration,!0):43===t?i<7?this.moveTextType4(e,i,e.Duration):i<14&&this.moveTextType5(e,i-7,e.Duration,!0):50===t?i<7?this.moveTextType5(e,i,e.Duration):i<11?this.moveTextType6(e,i-7,e.Duration,!0):i<16?this.moveTextType0(e,i-11,e.Duration,!0):i<23?this.moveTextType4(e,i-16,e.Duration):i<30&&this.moveTextType5(e,i-23,e.Duration,!0):51===t?i<7?this.moveTextType5(e,i,e.Duration):i<11?this.moveTextType6(e,i-7,e.Duration,!0):i<16?this.moveTextType0(e,i-11,e.Duration,!0):i<23?this.moveTextType4(e,i-16,e.Duration):i<27&&this.moveTextType7(e,i-23,e.Duration,!0):52===t?i<7?this.moveTextType5(e,i,e.Duration):i<11?this.moveTextType6(e,i-7,e.Duration,!0):i<16&&this.moveTextType1(e,i-11,e.Duration,!0):53===t?i<7?this.moveTextType5(e,i,e.Duration):i<14&&this.moveTextType4(e,i-7,e.Duration,!0):60===t?i<4?this.moveTextType6(e,i,e.Duration):i<8?this.moveTextType7(e,i-4,e.Duration,!0):i<13?this.moveTextType3(e,i-8,e.Duration,!0):i<20?this.moveTextType5(e,i-13,e.Duration):i<24?this.moveTextType6(e,i-20,e.Duration,!0):i<29&&this.moveTextType0(e,i-24,e.Duration,!0):61===t?i<4?this.moveTextType6(e,i,e.Duration):i<8?this.moveTextType7(e,i-4,e.Duration,!0):i<13?this.moveTextType3(e,i-8,e.Duration,!0):i<20?this.moveTextType5(e,i-13,e.Duration):i<27&&this.moveTextType4(e,i-20,e.Duration,!0):62===t?i<4?this.moveTextType6(e,i,e.Duration):i<8?this.moveTextType7(e,i-4,e.Duration,!0):i<13&&this.moveTextType2(e,i-8,e.Duration,!0):63===t?i<4?this.moveTextType6(e,i,e.Duration):i<11&&this.moveTextType5(e,i-4,e.Duration,!0):64===t?i<4?this.moveTextType6(e,i,e.Duration):i<11&&this.moveTextType4(e,i-4,e.Duration,!0):65===t?i<5&&this.moveTextType1(e,i,e.Duration,!0):70===t?i<4?this.moveTextType7(e,i,e.Duration):i<8?this.moveTextType6(e,i-4,e.Duration,!0):i<13?this.moveTextType0(e,i-8,e.Duration,!0):i<20?this.moveTextType4(e,i-13,e.Duration):i<24?this.moveTextType7(e,i-20,e.Duration,!0):i<29&&this.moveTextType3(e,i-24,e.Duration,!0):71===t?i<4?this.moveTextType7(e,i,e.Duration):i<8?this.moveTextType6(e,i-4,e.Duration,!0):i<13?this.moveTextType0(e,i-8,e.Duration,!0):i<20?this.moveTextType4(e,i-13,e.Duration):i<27&&this.moveTextType5(e,i-20,e.Duration,!0):72===t?i<4?this.moveTextType7(e,i,e.Duration):i<8?this.moveTextType6(e,i-4,e.Duration,!0):i<13&&this.moveTextType1(e,i-8,e.Duration,!0):73===t?i<4?this.moveTextType7(e,i,e.Duration):i<11&&this.moveTextType4(e,i-4,e.Duration,!0):74===t?i<4?this.moveTextType7(e,i,e.Duration):i<11&&this.moveTextType5(e,i-4,e.Duration,!0):75===t?i<5&&this.moveTextType2(e,i,e.Duration,!0):80===t?i<4?this.moveTextType7(e,i,e.Duration,!0):i<9?this.moveTextType3(e,i-4,e.Duration,!0):i<16?this.moveTextType5(e,i-9,e.Duration):i<20?this.moveTextType6(e,i-16,e.Duration,!0):i<25?this.moveTextType0(e,i-20,e.Duration,!0):i<32&&this.moveTextType4(e,i-25,e.Duration):81===t?i<4?this.moveTextType7(e,i,e.Duration,!0):i<9?this.moveTextType3(e,i-4,e.Duration,!0):i<16?this.moveTextType5(e,i-9,e.Duration):i<23&&this.moveTextType4(e,i-16,e.Duration,!0):82===t?i<4?this.moveTextType7(e,i,e.Duration,!0):i<9&&this.moveTextType2(e,i-4,e.Duration,!0):83===t?i<7&&this.moveTextType5(e,i,e.Duration,!0):84===t?i<7&&this.moveTextType4(e,i,e.Duration,!0):90===t?i<4?this.moveTextType6(e,i,e.Duration,!0):i<9?this.moveTextType0(e,i-4,e.Duration,!0):i<16?this.moveTextType4(e,i-9,e.Duration):i<20?this.moveTextType7(e,i-16,e.Duration,!0):i<25?this.moveTextType3(e,i-20,e.Duration,!0):i<32&&this.moveTextType5(e,i-25,e.Duration):91===t?i<4?this.moveTextType6(e,i,e.Duration,!0):i<9?this.moveTextType0(e,i-4,e.Duration,!0):i<16?this.moveTextType4(e,i-9,e.Duration):i<23&&this.moveTextType5(e,i-16,e.Duration,!0):92===t?i<4?this.moveTextType6(e,i,e.Duration,!0):i<9&&this.moveTextType1(e,i-4,e.Duration,!0):(console.log("%c!PhraseNumber error!","color: red"),i<5?this.moveTextType0(e,i,e.Duration):i<9?this.moveTextType6(e,i-5,e.Duration):i<13?this.moveTextType7(e,i-9,e.Duration,!0):i<18?this.moveTextType3(e,i-13,e.Duration,!0):i<25?this.moveTextType5(e,i-18,e.Duration):i<32&&this.moveTextType4(e,i-25,e.Duration,!0))}},{key:"moveTextType0",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0;n=o?Math.PI*(180+25.2*(5-t)/5)/180:Math.PI*(180+25.2*t/5)/180,this._MoveLyricText.moveTextBasic(e,i,n,{x:.5,y:-.05},{x:1.05,y:.04})}},{key:"moveTextType1",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0;n=o?Math.PI*(322.8+26.2*t/5)/180:Math.PI*(322.8+26.2*(5-t)/5)/180,this._MoveLyricText.moveTextBasic(e,i,n,{x:-.15,y:0},{x:-.65,y:-.14})}},{key:"moveTextType2",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0;n=o?Math.PI*(191+26.2*(5-t)/5)/180:Math.PI*(191+26.2*t/5)/180,this._MoveLyricText.moveTextBasic(e,i,n,{x:1.15,y:0},{x:1.65,y:-.14})}},{key:"moveTextType3",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0;n=o?Math.PI*(334.8+25.2*t/5)/180:Math.PI*(334.8+25.2*(5-t)/5)/180,this._MoveLyricText.moveTextBasic(e,i,n,{x:.5,y:-.05},{x:-.05,y:.04})}},{key:"moveTextType4",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0;n=o?Math.PI*(202.9+39.1*(7-t)/7)/180:Math.PI*(202.9+39.1*t/7)/180,this._MoveLyricText.moveTextBasic(e,i,n,{x:.5,y:-.05},{x:.9715,y:-.3515})}},{key:"moveTextType5",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0;n=o?Math.PI*(298+39.1*t/7)/180:Math.PI*(298+39.1*(7-t)/7)/180,this._MoveLyricText.moveTextBasic(e,i,n,{x:.5,y:-.05},{x:.0285,y:-.3515})}},{key:"moveTextType6",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0;n=o?Math.PI*(249.2+20.8*(4-t)/4)/180:Math.PI*(249.2+20.8*t/4)/180,this._MoveLyricText.moveTextBasic(e,i,n,{x:.5,y:-.05},{x:.5,y:-.469})}},{key:"moveTextType7",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0;n=o?Math.PI*(270+20.8*t/4)/180:Math.PI*(270+20.8*(4-t)/4)/180,this._MoveLyricText.moveTextBasic(e,i,n,{x:.5,y:-.05},{x:.5,y:-.469})}},{key:"movePhraseText",value:function(e,t,i){this._MoveLyricText.movePhraseText(e,t);var o=e.PhrasePlace,n=e.PhraseCharCount-1;0===o?(i.makeLine(0,n),i.makeLine(6,n-5),i.makeLine(7,n-9,!0),i.makeLine(3,n-13,!0),i.makeLine(5,n-18),i.makeLine(4,n-25,!0)):1===o?(i.makeLine(0,n),i.makeLine(6,n-5),i.makeLine(7,n-9,!0),i.makeLine(3,n-13,!0),i.makeLine(5,n-18),i.makeLine(6,n-25,!0)):2===o?(i.makeLine(0,n),i.makeLine(6,n-5),i.makeLine(5,n-9,!0)):3===o?(i.makeLine(0,n),i.makeLine(6,n-5),i.makeLine(4,n-9,!0)):4===o?(i.makeLine(0,n),i.makeLine(1,n-5,!0)):10===o?(i.makeLine(3,n),i.makeLine(7,n-5),i.makeLine(6,n-9,!0),i.makeLine(0,n-13,!0),i.makeLine(4,n-18),i.makeLine(5,n-25,!0)):11===o?(i.makeLine(3,n),i.makeLine(7,n-5),i.makeLine(6,n-9,!0),i.makeLine(0,n-13,!0),i.makeLine(4,n-18),i.makeLine(7,n-25,!0)):12===o?(i.makeLine(3,n),i.makeLine(7,n-5),i.makeLine(4,n-9,!0)):13===o?(i.makeLine(3,n),i.makeLine(7,n-5),i.makeLine(5,n-9,!0)):14===o?(i.makeLine(3,n),i.makeLine(2,n-5,!0)):20===o?(i.makeLine(1,n),i.makeLine(6,n-5),i.makeLine(7,n-9,!0),i.makeLine(3,n-13,!0),i.makeLine(5,n-18),i.makeLine(4,n-25,!0)):21===o?(i.makeLine(1,n),i.makeLine(6,n-5),i.makeLine(7,n-9,!0),i.makeLine(3,n-13,!0),i.makeLine(5,n-18),i.makeLine(6,n-25,!0)):22===o?(i.makeLine(1,n),i.makeLine(6,n-5),i.makeLine(5,n-9,!0)):23===o?(i.makeLine(1,n),i.makeLine(6,n-5),i.makeLine(4,n-9,!0)):24===o?(i.makeLine(1,n),i.makeLine(0,n-5,!0)):30===o?(i.makeLine(2,n),i.makeLine(7,n-5),i.makeLine(6,n-9,!0),i.makeLine(0,n-13,!0),i.makeLine(4,n-18),i.makeLine(5,n-25,!0)):31===o?(i.makeLine(2,n),i.makeLine(7,n-5),i.makeLine(6,n-9,!0),i.makeLine(0,n-13,!0),i.makeLine(4,n-18),i.makeLine(7,n-25,!0)):32===o?(i.makeLine(2,n),i.makeLine(7,n-5),i.makeLine(4,n-9,!0)):33===o?(i.makeLine(2,n),i.makeLine(7,n-5),i.makeLine(5,n-9,!0)):34===o?(i.makeLine(2,n),i.makeLine(3,n-5,!0)):40===o?(i.makeLine(4,n),i.makeLine(7,n-7,!0),i.makeLine(3,n-11,!0),i.makeLine(5,n-16),i.makeLine(4,n-23,!0)):41===o?(i.makeLine(4,n),i.makeLine(7,n-7,!0),i.makeLine(3,n-11,!0),i.makeLine(5,n-16),i.makeLine(6,n-23,!0)):42===o?(i.makeLine(4,n),i.makeLine(7,n-7,!0),i.makeLine(2,n-11,!0)):43===o?(i.makeLine(4,n),i.makeLine(5,n-7,!0)):50===o?(i.makeLine(5,n),i.makeLine(6,n-7,!0),i.makeLine(0,n-11,!0),i.makeLine(4,n-16),i.makeLine(5,n-23,!0)):51===o?(i.makeLine(5,n),i.makeLine(6,n-7,!0),i.makeLine(0,n-11,!0),i.makeLine(4,n-16),i.makeLine(7,n-23,!0)):52===o?(i.makeLine(5,n),i.makeLine(6,n-7,!0),i.makeLine(1,n-11,!0)):53===o?(i.makeLine(5,n),i.makeLine(4,n-7,!0)):60===o?(i.makeLine(6,n),i.makeLine(7,n-4,!0),i.makeLine(3,n-8,!0),i.makeLine(5,n-13),i.makeLine(6,n-20,!0),i.makeLine(0,n-24,!0)):61===o?(i.makeLine(6,n),i.makeLine(7,n-4,!0),i.makeLine(3,n-8,!0),i.makeLine(5,n-13),i.makeLine(4,n-20,!0)):62===o?(i.makeLine(6,n),i.makeLine(7,n-4,!0),i.makeLine(2,n-8,!0)):63===o?(i.makeLine(6,n),i.makeLine(5,n-4,!0)):64===o?(i.makeLine(6,n),i.makeLine(4,n-4,!0)):65===o?i.makeLine(1,n,!0):70===o?(i.makeLine(7,n),i.makeLine(6,n-4,!0),i.makeLine(0,n-8,!0),i.makeLine(4,n-13),i.makeLine(7,n-20,!0),i.makeLine(3,n-24,!0)):71===o?(i.makeLine(7,n),i.makeLine(6,n-4,!0),i.makeLine(0,n-8,!0),i.makeLine(4,n-13),i.makeLine(5,n-20,!0)):72===o?(i.makeLine(7,n),i.makeLine(6,n-4,!0),i.makeLine(1,n-8,!0)):73===o?(i.makeLine(7,n),i.makeLine(4,n-4,!0)):74===o?(i.makeLine(7,n),i.makeLine(5,n-4,!0)):75===o?i.makeLine(2,n,!0):80===o?(i.makeLine(7,n,!0),i.makeLine(3,n-4,!0),i.makeLine(5,n-9),i.makeLine(6,n-16,!0),i.makeLine(0,n-20,!0),i.makeLine(4,n-25)):81===o?(i.makeLine(7,n,!0),i.makeLine(3,n-4,!0),i.makeLine(5,n-9),i.makeLine(4,n-16,!0)):82===o?(i.makeLine(7,n,!0),i.makeLine(2,n-4,!0)):83===o?i.makeLine(5,n,!0):84===o?i.makeLine(4,n,!0):90===o?(i.makeLine(6,n,!0),i.makeLine(0,n-4,!0),i.makeLine(4,n-9),i.makeLine(7,n-16,!0),i.makeLine(3,n-20,!0),i.makeLine(5,n-25)):91===o?(i.makeLine(6,n,!0),i.makeLine(0,n-4,!0),i.makeLine(4,n-9),i.makeLine(5,n-16,!0)):92===o?(i.makeLine(6,n,!0),i.makeLine(1,n-4,!0)):(i.makeLine(0,n),i.makeLine(6,n-5),i.makeLine(7,n-9,!0),i.makeLine(3,n-13,!0),i.makeLine(5,n-18),i.makeLine(4,n-25,!0))}},{key:"startCharPlace",value:function(e){var t=Math.PI,i={x:0,y:0};return 0===e||4===e?(i.x=1.05+Math.cos(t),i.y=.04+Math.sin(t)):1===e||5===e?(i.x=-.05+Math.cos(0),i.y=.04+Math.sin(0)):2===e?(i.x=-.65+Math.cos(11*t/180),i.y=-.14+Math.sin(11*t/180)):3===e?(i.x=1.65+Math.cos(169*t/180),i.y=-.14+Math.sin(169*t/180)):6===e?(i.x=-.65+Math.cos(37.2*t/180),i.y=-.14+Math.sin(37.2*t/180)):7===e?(i.x=1.65+Math.cos(142.8*t/180),i.y=-.14+Math.sin(142.8*t/180)):(i.x=.5+Math.cos(90*t/180),i.y=-.469+Math.sin(90*t/180)),i}}]),e}();function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,o=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return(0,T.Z)(this,i)}}var D=function(e){(0,d.Z)(i,e);var t=b(i);function i(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;(0,n.Z)(this,i),e=t.call(this),(0,r.Z)((0,m.Z)(e),"phraseLineNumber",void 0),(0,r.Z)((0,m.Z)(e),"isGameNow",void 0),(0,r.Z)((0,m.Z)(e),"fontLoaded",void 0),(0,r.Z)((0,m.Z)(e),"_TestText",void 0),(0,r.Z)((0,m.Z)(e),"_LyricText",void 0),(0,r.Z)((0,m.Z)(e),"_BeatSprite",void 0),(0,r.Z)((0,m.Z)(e),"_ScoreText",void 0),(0,r.Z)((0,m.Z)(e),"_SomeSprite",void 0),(0,r.Z)((0,m.Z)(e),"_TouchLine",void 0),(0,r.Z)((0,m.Z)(e),"bg",void 0),(0,r.Z)((0,m.Z)(e),"_player",void 0),(0,r.Z)((0,m.Z)(e),"SONGURL",void 0),(0,r.Z)((0,m.Z)(e),"charBuffer",void 0),(0,r.Z)((0,m.Z)(e),"phraseBuffer",void 0),(0,r.Z)((0,m.Z)(e),"beatBuffer",void 0),(0,r.Z)((0,m.Z)(e),"beatDuration",void 0),(0,r.Z)((0,m.Z)(e),"beatLength",void 0),(0,r.Z)((0,m.Z)(e),"basedScore",void 0),(0,r.Z)((0,m.Z)(e),"bonusScore",void 0),(0,r.Z)((0,m.Z)(e),"beatTouched",void 0),(0,r.Z)((0,m.Z)(e),"_MoveTextTypes",void 0);var a=l.wr,u=l.hr;l.textScale;return e.sortableChildren=!0,e.phraseLineNumber=0,e.isGameNow=!1,e.fontLoaded=!1,e._TestText=null,e._LyricText=null,e._BeatSprite=null,e._SomeSprite=new M,e.addChild(e._SomeSprite),e._TouchLine=new k,e._TouchLine.scale.set(100*a/1920,100*u/1080),e.addChild(e._TouchLine),e._ScoreText=null,e.bg=(new s.Graphics).beginFill(0).drawRect(0,0,100*a,100*u).endFill(),e.bg.alpha=0,e.bg.zIndex=-10,e.bg.interactive=!0,e.bg.buttonMode=!1,e.bg.visible=!1,e.addChild(e.bg),window.addEventListener("keyup",(function(t){e.keyEvent(t)})),e.SONGURL=o,e._player=new f.J5({app:{token:"Q3ofuMm4ppwyWZfn"},mediaElement:l._media,mediaBannerPosition:null,valenceArousalEnabled:!0,vocalAmplitudeEnabled:!0}),e._player.addListener({onAppReady:function(t){return e._onAppReady(t)},onVideoReady:function(t){return e._onVideoReady(t)},onTimerReady:function(t){return e._onTimerReady(t)},onPlay:function(){return e._onPlay()},onPause:function(){return e._onPause()},onTimeUpdate:function(t){return e._onTimeUpdate(t)}}),e.charBuffer=null,e.phraseBuffer=null,e.beatBuffer=null,e.beatDuration=3e3,e.beatLength=4,e.basedScore=0,e.bonusScore=0,e.beatTouched=!1,e._MoveTextTypes=null,e}return(0,a.Z)(i,[{key:"_onAppReady",value:function(e){console.log("%c!AppReady","color: aqua"),e.songUrl||(0===this.SONGURL?this._player.createFromSongUrl("https://piapro.jp/t/FDb1/20210213190029",{video:{beatId:3953882,repetitiveSegmentId:2099561,lyricId:52065,lyricDiffId:5093}}):1===this.SONGURL?this._player.createFromSongUrl("https://www.youtube.com/watch?v=pAaD4Hta0ns",{video:{beatId:3953761,repetitiveSegmentId:2099586,lyricId:52094,lyricDiffId:5171}}):2===this.SONGURL?this._player.createFromSongUrl("http://www.youtube.com/watch?v=bMtYf3R0zhY",{video:{beatId:3953902,repetitiveSegmentId:2099660,lyricId:52093,lyricDiffId:5177}}):3===this.SONGURL?this._player.createFromSongUrl("https://www.youtube.com/watch?v=Se89rQPp5tk",{video:{beatId:3953908,repetitiveSegmentId:2099661,lyricId:52061,lyricDiffId:5123}}):4===this.SONGURL?this._player.createFromSongUrl("https://www.youtube.com/watch?v=3wbZUkPxHEg",{video:{beatId:3953764,repetitiveSegmentId:2099662,lyricId:52062,lyricDiffId:5133}}):this._player.createFromSongUrl("http://www.youtube.com/watch?v=Ch4RQPG1Tmo",{video:{beatId:3953917,repetitiveSegmentId:2099665,lyricId:52063,lyricDiffId:5149}})),this._player.volume=50}},{key:"_onVideoReady",value:function(e){console.log("%c!VideoReady","color: aqua"),console.log("v",e);var t=this._player.data.getBeats()[10]||this._player.data.getBeats()[0],i=this._player.getBeats(),o=i[i.length-1];this.beatDuration=t.duration,console.log("beatAveData",t),console.log("lastbeat",o),this._BeatSprite=new P,this._BeatSprite.zIndex=-100,this.addChild(this._BeatSprite),this.basedScore=1e6/e.charCount,this.bonusScore=1e4/(o.index+1),this._ScoreText=new R(this.basedScore,this.bonusScore),this.addChild(this._ScoreText),this._MoveTextTypes=new S(this._ScoreText),this.bg.on("touchstart",this._beatTocuh,this),this.changeStyle(),this.fontLoad(e)}},{key:"_onTimerReady",value:function(e){console.log("%c!TimerReady","color: aqua")}},{key:"_onPlay",value:function(){console.log("%c!Play","color: aqua"),this.isGameNow=!0,this.bg.visible=!0}},{key:"_onPause",value:function(){console.log("%c!Pause","color: aqua"),this._player.video.endTime<this._player.timer.position?console.log("END"):console.log("NOT END"),this.isGameNow=!1,this.bg.visible=!1}},{key:"_onTimeUpdate",value:function(e){if(this._TestText&&this._LyricText&&this._BeatSprite){var t=this._player.video.findPhrase(e+2e3);if(t&&t!==this.phraseBuffer){var i=this._player.video.findIndex(t),o=this._LyricText.phraseTexts[i];this.showPhrase(o),this.touchLineAnimation(this._TouchLine.children.slice(this.phraseLineNumber),t.duration),this.showStartCharPlace(o.PhrasePlace),this.phraseBuffer=t}var n=this._player.video.findChar(e+1e3);n&&n!==this.charBuffer&&(this.showChar(n),this.charBuffer=n);var a=this._player.findBeat(e);a&&a!==this.beatBuffer&&(this._TestText._text2.text=a.position.toString(),this._BeatSprite.newBeat(a),this.beatBuffer=a,this.beatTouched||(this._BeatSprite.iloveMiku.alpha=.3));var r=a.progress(e);.3<r&&r<.8&&(this.beatTouched=!1)}}},{key:"showChar",value:function(e){if(this._LyricText&&this._MoveTextTypes){e.previous&&e.previous!==this.charBuffer&&this.showChar(e.previous);var t=this._player.video.findIndex(e),i=this._LyricText.charTextBoxs[t];console.log("V:",t),console.log("char.text",e.text),this._MoveTextTypes.moveCharText(i)}}},{key:"showPhrase",value:function(e){this._MoveTextTypes&&this._MoveTextTypes.movePhraseText(e,this.beatDuration,this._TouchLine)}},{key:"touchLineAnimation",value:function(e,t){this.phraseLineNumber=this._TouchLine.children.length,u.ZP.timeline().to(e,{pixi:{alpha:1},duration:.1,delay:.4,yoyo:!0,repeat:4}).to(e,{pixi:{alpha:.2},duration:1,delay:1}).to(e,{pixi:{alpha:0},duration:.1,delay:(t-1e3)/1e3})}},{key:"showStartCharPlace",value:function(e){if(this._MoveTextTypes){var t=Math.floor(e/10),i=this._MoveTextTypes.startCharPlace(t);i.x*=l.width,i.y*=1920*l.height/1080,this._SomeSprite.showStartCharAnimation(i)}}},{key:"keyEvent",value:function(e){e.preventDefault(),this.isGameNow&&("Space"!==e.code&&" "!==e.key||this._beatTocuh(!0))}},{key:"_beatTocuh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!(this.isGameNow&&this.beatTouched||!this._BeatSprite)&&this._ScoreText){var t=this._player.timer.position,i=this._player.findBeat(t);if(i){var o=i.progress(t);console.log(o),o<.3||.8<o?(this._BeatSprite.iloveMiku.alpha=1,this._ScoreText.changeBonus(),this.beatTouched=!0):e&&(this._BeatSprite.iloveMiku.alpha=.3,this._ScoreText.changeBonus(!0))}}}},{key:"_requestPlay",value:function(){this._player.requestPlay()}},{key:"debug",value:function(){console.log("%c!tap","color: red")}},{key:"changeStyle",value:function(){var e=80.8*l.wr/2;l.isSafari?l._media.style.left="".concat(e,"px"):l._media.style.transform="translate(-50%, 0%)"}},{key:"fontLoad",value:function(e){var t=this,i=this._player.data.text.replace(/\n/g,"");console.log(i),s.Loader.shared.add({name:"Yusei Magic",url:"https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap",metadata:{font:{testString:i}}}),s.Loader.shared.onComplete.once((function(){return t.fontLoadEnd(e,i)}),this),s.Loader.shared.load()}},{key:"fontLoadEnd",value:function(e,t){if(this._ScoreText){this.fontLoaded=!0,console.log("%c!fontLoaded","color: green"),this._TestText=new Z,this._TestText._text2.interactive=!0,this._TestText._text2.buttonMode=!0,this._TestText._text2.on("pointertap",this._requestPlay,this),this.addChild(this._TestText);var i=performance.now();this._LyricText=new w(e,this._ScoreText,t),this.addChild(this._LyricText);var o=performance.now();console.log("!!!3rd",o-i)}}},{key:"update",value:function(){}},{key:"resize",value:function(){}}]),i}(s.Container),Z=function(e){(0,d.Z)(i,e);var t=b(i);function i(){var e;(0,n.Z)(this,i),e=t.call(this),(0,r.Z)((0,m.Z)(e),"_text2",void 0),(0,r.Z)((0,m.Z)(e),"centerLine",void 0);var o=l.wr,a=l.hr,u=l.textScale;return e._text2=new s.BitmapText("0",{fontName:"BasicRocknRoll",tint:0,fontSize:64}),e._text2.anchor.set(.5),e._text2.position.set(10*o,90*a),e._text2.scale.set(u),e.addChild(e._text2),e.centerLine=(new s.Graphics).lineStyle(2,16711680).moveTo(50*o,0).lineTo(50*o,100*a).moveTo(0,50*a).lineTo(100*o,50*a),e.addChild(e.centerLine),e}return i}(s.Container),_=function(){function e(t){(0,n.Z)(this,e),this._ScoreText=t,(0,r.Z)(this,"basedWidth",1920),(0,r.Z)(this,"basedHeight",1080),(0,r.Z)(this,"W",l.width),(0,r.Z)(this,"H",l.height),(0,r.Z)(this,"TR",l.textScale),(0,r.Z)(this,"WtoH",l.height*this.basedWidth/this.basedHeight)}return(0,a.Z)(e,[{key:"moveTextBasic",value:function(e,t,i,o,n){var a=this;e.TextBox.position.set(o.x*this.W,o.y*this.WtoH);var r=u.ZP.timeline();e.TextBox.visible=!0,r.to(e.TextBox,{pixi:{x:(n.x+Math.cos(i))*this.W,y:(n.y-Math.sin(i))*this.WtoH},duration:.8,ease:"none",onComplete:function(){e.Reached=!0}}).to(e.TextBox,{pixi:{alpha:0},duration:.5,delay:(t+50)/1e3,ease:"none",onComplete:function(){e.TextBox.visible=!1,e.Touched||a._ScoreText.cancelCombo()}})}},{key:"movePhraseText",value:function(e,t){var i=e.TextBox,o=e.Duration,n=e.NextDuration;i.position.set(.5*this.W,.39*this.H);var a=u.ZP.timeline();i.visible=!0,a.to(i,{pixi:{y:"-="+.03*this.H,alpha:1},duration:t/1e3,delay:1.6}).to(i,{pixi:{y:"-="+.07*this.H,scale:.7*this.TR,alpha:.2},duration:t/1e3,delay:(o-t-200)/1e3}).to(i,{pixi:{alpha:0},duration:t/1e3,delay:(n-t)/1e3,onComplete:function(){i.visible=!1}})}}]),e}(),M=function(e){(0,d.Z)(i,e);var t=b(i);function i(){var e;(0,n.Z)(this,i),e=t.call(this),(0,r.Z)((0,m.Z)(e),"flower",void 0),(0,r.Z)((0,m.Z)(e),"showStartCharFlower",void 0);var o=l.wr;l.hr,l.textScale;return e.flower=s.Texture.from("mainFlower"),e.showStartCharFlower=s.Sprite.from(e.flower),e.showStartCharFlower.anchor.set(.5),e.showStartCharFlower.alpha=0,e.showStartCharFlower.scale.set(.06*o),e.addChild(e.showStartCharFlower),u.ZP.to(e.showStartCharFlower,{pixi:{rotation:359},duration:3,repeat:-1,ease:"none"}),e}return(0,a.Z)(i,[{key:"showStartCharAnimation",value:function(e){u.ZP.killTweensOf(this.showStartCharFlower),this.showStartCharFlower.alpha=0,this.showStartCharFlower.scale.set(.06*l.wr),this.showStartCharFlower.position.set(e.x,e.y),u.ZP.timeline().to(this.showStartCharFlower,{pixi:{alpha:1.2,scale:0},duration:2.5})}}]),i}(s.Container),B=function(e){return("0000000"+Math.round(e)).slice(-7)},C=function(e){return("00000"+Math.round(e)).slice(-5)},R=function(e){(0,d.Z)(i,e);var t=b(i);function i(e,o){var a;(0,n.Z)(this,i),(a=t.call(this)).normalAddScore=e,a.bonusAddScore=o,(0,r.Z)((0,m.Z)(a),"score",void 0),(0,r.Z)((0,m.Z)(a),"combo",void 0),(0,r.Z)((0,m.Z)(a),"bonus",void 0),(0,r.Z)((0,m.Z)(a),"scoreText",void 0),(0,r.Z)((0,m.Z)(a),"scoreNumber",void 0),(0,r.Z)((0,m.Z)(a),"comboText",void 0),(0,r.Z)((0,m.Z)(a),"comboNumber",void 0),(0,r.Z)((0,m.Z)(a),"bonusText",void 0),(0,r.Z)((0,m.Z)(a),"bonusNumber",void 0),(0,r.Z)((0,m.Z)(a),"scoreHR",l.hr);var u=l.wr,h=l.hr,c=l.textScale;return a.score=0,a.combo=0,a.bonus=0,a.scoreText=new s.BitmapText("SCORE",{fontName:"ScoreRocknRoll",tint:183500,fontSize:48}),a.scoreText.anchor.set(1),a.scoreText.position.set(88*u,98.5*h),a.scoreText.scale.set(c),a.addChild(a.scoreText),a.scoreNumber=new s.BitmapText(B(0),{fontName:"ScoreRocknRoll",tint:183500,fontSize:48}),a.scoreNumber.anchor.set(1),a.scoreNumber.position.set(101*u,98.5*h),a.scoreNumber.scale.set(c),a.addChild(a.scoreNumber),a.comboText=new s.BitmapText("COMBO",{fontName:"ScoreRocknRoll",tint:183500,fontSize:32}),a.comboText.anchor.set(1),a.comboText.position.set(96*u,88.5*h),a.comboText.scale.set(c),a.comboText.alpha=0,a.addChild(a.comboText),a.comboNumber=new s.BitmapText("0",{fontName:"ScoreRocknRoll",tint:183500,fontSize:32}),a.comboNumber.anchor.set(1),a.comboNumber.position.set(100.5*u,88.5*h),a.comboNumber.scale.set(c),a.comboNumber.alpha=0,a.addChild(a.comboNumber),a.bonusText=new s.BitmapText("BONUS",{fontName:"ScoreRocknRoll",tint:183500,fontSize:48}),a.bonusText.anchor.set(1),a.bonusText.position.set(92*u,93.5*h),a.bonusText.scale.set(c),a.addChild(a.bonusText),a.bonusNumber=new s.BitmapText(C(0),{fontName:"ScoreRocknRoll",tint:183500,fontSize:48}),a.bonusNumber.anchor.set(1),a.bonusNumber.position.set(101*u,93.5*h),a.bonusNumber.scale.set(c),a.addChild(a.bonusNumber),a}return(0,a.Z)(i,[{key:"changeScore",value:function(){var e=this,t=this.score;this.score+=this.normalAddScore;var i=this.combo;this.combo+=1;var o=this.normalAddScore/60,n=o;u.ZP.killTweensOf(this.scoreNumber),this.scoreNumber.text=B(t),u.ZP.to(this.scoreNumber,{onUpdate:function(){e.scoreNumber.text=B(t+n),n+=o},onComplete:function(){e.scoreNumber.text=B(e.score)},duration:1}),this.combo>9&&(u.ZP.killTweensOf(this.comboNumber),this.comboNumber.text=i.toString(),this.comboText.alpha=1,this.comboNumber.alpha=1,this.comboNumber.y=88.5*l.hr,u.ZP.to(this.comboNumber,{pixi:{y:"-="+this.scoreHR,alpha:0},duration:.05,yoyo:!0,repeat:1,onRepeat:function(){e.comboNumber.text=e.combo.toString()},onComplete:function(){e.comboNumber.text=e.combo.toString(),e.comboText.alpha=1,e.comboNumber.alpha=1,e.comboNumber.y=88.5*l.hr}}))}},{key:"changeBonus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("%cBOUNUS","color: aqua");var i=this.bonusAddScore;t&&(i*=-.1);var o=this.bonus;this.bonus+=i,u.ZP.killTweensOf(this.bonusNumber),this.bonusNumber.text=C(o),this.bonusText.alpha=1,this.bonusNumber.alpha=1,this.bonusNumber.y=93.5*l.hr,u.ZP.to(this.bonusNumber,{pixi:{y:"-="+this.scoreHR,alpha:0},duration:.05,yoyo:!0,repeat:1,onRepeat:function(){e.bonusNumber.text=C(e.bonus)},onComplete:function(){e.bonusNumber.text=C(e.bonus),e.bonusText.alpha=1,e.bonusNumber.alpha=1,e.bonusNumber.y=93.5*l.hr}})}},{key:"cancelCombo",value:function(){u.ZP.killTweensOf(this.comboNumber),this.combo=0,this.comboText.alpha=0,this.comboNumber.alpha=0}}]),i}(s.Container),P=function(e){(0,d.Z)(i,e);var t=b(i);function i(){var e;(0,n.Z)(this,i),e=t.call(this),(0,r.Z)((0,m.Z)(e),"iloveMiku",void 0),(0,r.Z)((0,m.Z)(e),"dancingMiku",void 0),(0,r.Z)((0,m.Z)(e),"mikuTypeBuffer",void 0),(0,r.Z)((0,m.Z)(e),"scoreHR",3*l.hr);var o=l.wr,a=l.hr;l.textScale;e.iloveMiku=new s.Container,e.dancingMiku=new Array;var u=s.Sprite.from("leftMiku");u.anchor.set(.5),u.scale.set(.02*o),u.position.set(50*o,60*a),u.alpha=0,e.iloveMiku.addChild(u),e.dancingMiku.push(u);var h=s.Sprite.from("centerMiku");h.anchor.set(.49,.45),h.scale.set(.02*o),h.position.set(50*o,60*a),h.alpha=1,e.iloveMiku.addChild(h),e.dancingMiku.push(h);var c=s.Sprite.from("rightMiku");return c.anchor.set(.5),c.scale.set(.02*o),c.position.set(50*o,60*a),c.alpha=0,e.iloveMiku.addChild(c),e.dancingMiku.push(c),e.iloveMiku.alpha=.3,e.addChild(e.iloveMiku),e.mikuTypeBuffer=1,e}return(0,a.Z)(i,[{key:"newBeat",value:function(e){var t=this,i=0;i=3===e.length?e.index%2?e.position-1:3-e.position:e.position%2?e.position-1:1,u.ZP.timeline().to(this.dancingMiku[this.mikuTypeBuffer],{pixi:{y:"-="+this.scoreHR,alpha:0},duration:(e.duration-200)/2e3}).to(this.dancingMiku[i],{pixi:{y:"+="+this.scoreHR,alpha:1},duration:(e.duration-200)/2e3,onComplete:function(){t.mikuTypeBuffer=i}})}}]),i}(s.Container);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,o=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return(0,T.Z)(this,i)}}var I=0,F=function(){I>0&&clearTimeout(I),I=window.setTimeout((function(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);l._onResize(e,t)}),300)},O=function(e){(0,d.Z)(i,e);var t=N(i);function i(){var e;(0,n.Z)(this,i),e=t.call(this),(0,r.Z)((0,m.Z)(e),"suggestText1",void 0),(0,r.Z)((0,m.Z)(e),"suggestText2",void 0),(0,r.Z)((0,m.Z)(e),"suggestText3",void 0),(0,r.Z)((0,m.Z)(e),"continueButton",void 0);var o=l.wr,a=l.hr,h=l.textScale;return window.addEventListener("resize",F),e.suggestText1=new s.BitmapText("\u6a2a\u753b\u9762\u63a8\u5968\u3067\u3059",{fontName:"BasicRocknRoll",tint:0,fontSize:128}),e.suggestText1.anchor.set(.5),e.suggestText1.position.set(50*o,40*a),e.suggestText1.scale.set(h),e.addChild(e.suggestText1),e.suggestText2=new s.BitmapText("please play the game in landscape mode",{fontName:"BasicRocknRoll",tint:0,fontSize:64}),e.suggestText2.anchor.set(.5),e.suggestText2.position.set(50*o,50*a),e.suggestText2.scale.set(h),e.addChild(e.suggestText2),e.suggestText3=new s.BitmapText("\u30d1\u30bd\u30b3\u30f3\u306e\u5834\u5408\u306f\u753b\u9762\u3092\u6a2a\u306b\u9577\u304f\u3057\u3066\u304b\u3089\u904a\u3093\u3067\u304f\u3060\u3055\u3044",{fontName:"BasicRocknRoll",tint:7368816,fontSize:72}),e.suggestText3.anchor.set(.5),e.suggestText3.position.set(50*o,60*a),e.suggestText3.scale.set(h),e.addChild(e.suggestText3),e.continueButton=new s.BitmapText("> Continue <",{fontName:"BasicRocknRoll",tint:7368816,fontSize:64}),e.continueButton.anchor.set(.5),e.continueButton.position.set(50*o,80*a),e.continueButton.scale.set(h),e.continueButton.alpha=0,e.continueButton.interactive=!0,e.continueButton.buttonMode=!0,e.continueButton.on("pointertap",e.goGameMenuScene,(0,m.Z)(e)),e.addChild(e.continueButton),u.ZP.to(e.continueButton,{pixi:{alpha:1},duration:.2,delay:1.5}),e}return(0,a.Z)(i,[{key:"goGameMenuScene",value:function(){window.removeEventListener("resize",F),u.ZP.to(this,{pixi:{alpha:0},duration:.5,onComplete:function(){return l.changeScene(new D)}})}},{key:"update",value:function(){}},{key:"resize",value:function(){var e=l.wr,t=l.hr,i=l.textScale;this.suggestText1.position.set(50*e,37*t),this.suggestText1.scale.set(.8*i),this.suggestText2.position.set(50*e,50*t),this.suggestText2.scale.set(.8*i),this.suggestText3.position.set(50*e,60*t),this.suggestText3.scale.set(.8*i),this.continueButton.position.set(50*e,80*t),this.continueButton.scale.set(.8*i)}}]),i}(s.Container);function z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,o=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return(0,T.Z)(this,i)}}var E=function(e){(0,d.Z)(i,e);var t=z(i);function i(){var e;(0,n.Z)(this,i),e=t.call(this),(0,r.Z)((0,m.Z)(e),"_LoadingFlower",void 0),(0,r.Z)((0,m.Z)(e),"loadingText",void 0),(0,r.Z)((0,m.Z)(e),"tick",void 0),console.log("resolution",window.devicePixelRatio);var o=l.wr,a=l.hr,u=l.textScale;return e.sortableChildren=!0,e.tick=0,e.loadingText=new s.Text("Loading.",{fontFamily:"RocknRoll One",fill:0,fontSize:64}),e.loadingText.resolution=2,e.loadingText.anchor.y=.5,e.loadingText.position.set(35*o,50*a),e.loadingText.scale.set(2*u),e.loadingText.zIndex=100,e.addChild(e.loadingText),e._LoadingFlower=new G,e._LoadingFlower.position.set(50*o,50*a),e._LoadingFlower.scale.set(o<a?.15*a:.1*o),e._LoadingFlower.alpha=.5,e.addChild(e._LoadingFlower),s.Loader.shared.add(x),s.Loader.shared.onProgress.add(e.downloadProgress,(0,m.Z)(e)),s.Loader.shared.onComplete.once(e.gameLoaded,(0,m.Z)(e)),s.Loader.shared.onError.once(e.errorHandle,(0,m.Z)(e)),s.Loader.shared.load(),e}return(0,a.Z)(i,[{key:"downloadProgress",value:function(e){this._LoadingFlower.flowermask.y=-4*e.progress}},{key:"gameLoaded",value:function(){this.initSetting(),this._LoadingFlower.flowermask.visible=!1,u.p8.to(this,{pixi:{alpha:0},duration:.5,delay:.2,onComplete:this.changeScene})}},{key:"errorHandle",value:function(){setTimeout((function(){void 0!==window?window.location.reload():location.reload()}),1e3)}},{key:"initSetting",value:function(){s.BitmapFont.from("BasicRocknRoll",{fontFamily:"RocknRoll One",fill:"#ffffff",fontSize:64},{resolution:2,chars:s.Loader.shared.resources.fontText.data.required.join("")+s.Loader.shared.resources.fontText.data.text.join("")}),s.BitmapFont.from("ScoreRocknRoll",{fontFamily:"RocknRoll One",fontSize:48,fontStyle:"italic",fontWeight:"bold",fill:["#ffffff","#039393"],stroke:"#4a1850",strokeThickness:5,dropShadow:!0,dropShadowColor:"#000000",dropShadowBlur:4,dropShadowAngle:Math.PI/6,dropShadowDistance:6,wordWrap:!0,wordWrapWidth:440,lineJoin:"round"},{resolution:2,chars:s.Loader.shared.resources.fontText.data.required.join("")+s.Loader.shared.resources.fontText.data.text.join("")})}},{key:"setAssetsVolume",value:function(){}},{key:"changeScene",value:function(){Math.max(document.documentElement.clientWidth,window.innerWidth||0)<Math.max(document.documentElement.clientHeight,window.innerHeight||0)?l.changeScene(new O):l.changeScene(new D)}},{key:"update",value:function(){this.tick+=1,90===this.tick&&(this.tick=0),this.tick<30?this.loadingText.text="Loading.":this.tick<60?this.loadingText.text="Loading..":this.loadingText.text="Loading..."}},{key:"resize",value:function(){}}]),i}(s.Container),G=function(e){(0,d.Z)(i,e);var t=z(i);function i(){var e;(0,n.Z)(this,i),e=t.call(this),(0,r.Z)((0,m.Z)(e),"flower",void 0),(0,r.Z)((0,m.Z)(e),"flowerBGSprite",void 0),(0,r.Z)((0,m.Z)(e),"flowerSprite",void 0),(0,r.Z)((0,m.Z)(e),"flowermask",void 0);l.wr,l.hr,l.textScale;return e.flower=s.Texture.from("LoadingMiku.png"),e.flowerSprite=s.Sprite.from(e.flower),e.addChild(e.flowerSprite),e.flowerBGSprite=s.Sprite.from(e.flower),e.addChild(e.flowerBGSprite),e.flowermask=(new s.Graphics).beginFill(0,1).drawRect(0,0,400,400).endFill(),e.addChild(e.flowermask),e.flowermask.mask=e.flowerBGSprite,e.pivot.set(200,200),e}return i}(s.Container),A=i(5893),H=function(){var e=(0,o.useRef)(null),t=(0,o.useRef)(null);return(0,o.useEffect)((function(){var i=e.current,o=t.current;if(i&&o){var n=Math.max(document.documentElement.clientWidth,window.innerWidth||0),a=Math.max(document.documentElement.clientHeight,window.innerHeight||0);l.initialize(i,o,n,a);var r=new E;l.changeScene(r)}}),[e,t]),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("canvas",{ref:e}),(0,A.jsx)("div",{ref:t,id:"media"})]})}}}]);